/*
 * Compressed by JSA(www.xidea.org)
 */
if(typeof(Control)=="undefined")Control={};Control.TextArea=Class.create();Object.extend(Control.TextArea.prototype,{onChangeTimeoutLength:500,element:false,onChangeTimeout:false,initialize:function(_){this.element=$(_);$(this.element).observe("keyup",this.doOnChange.bindAsEventListener(this));$(this.element).observe("paste",this.doOnChange.bindAsEventListener(this));$(this.element).observe("input",this.doOnChange.bindAsEventListener(this))},doOnChange:function($){if(this.onChangeTimeout)window.clearTimeout(this.onChangeTimeout);this.onChangeTimeout=window.setTimeout(function(){if(this.notify)this.notify("change",this.getValue())}.bind(this),this.onChangeTimeoutLength)},getValue:function(){return this.element.value},getSelection:function(){if(document.selection)return document.selection.createRange().text;else if(this.element.setSelectionRange)return this.element.value.substring(this.element.selectionStart,this.element.selectionEnd);else if(window.getSelection){this.element.focus();return window.getSelection().toString()}else return false},replaceSelection:function(_){var B=this.element.scrollTop,C=_.length;if(!!document.selection){this.element.focus();var $=document.selection.createRange().text,A=document.selection.createRange();A.text=_;A-=$.length-_.length}else if(!!this.element.setSelectionRange){var D=this.element.selectionStart,E=this.element.selectionEnd;this.element.value=this.element.value.slice(0,D)+_+this.element.value.slice(E);this.element.setSelectionRange(D,D+_.length)}this.doOnChange();this.element.focus()},wrapSelection:function(_,$){this.replaceSelection(_+this.getSelection()+$)},insertBeforeSelection:function($){this.replaceSelection($+this.getSelection())},insertAfterSelection:function($){this.replaceSelection(this.getSelection()+$)},injectEachSelectedLine:function(A,_,$){this.replaceSelection((_||"")+$A(this.getSelection().split("\n")).inject([],A).join("\n")+($||""))},insertBeforeEachSelectedLine:function(_,A,$){this.injectEachSelectedLine(function(A,$){A.push(_+$);return A},A,$)}});if(typeof(Object.Event)!="undefined")Object.Event.extend(Control.TextArea);Control.TextArea.BBCode=Class.create();Object.extend(Control.TextArea.BBCode.prototype,{textarea:false,tooltip:false,toolbar:false,emotions:false,wrapper:false,controllers:false,initialize:function($){this.textarea=new Control.TextArea($);this._initLayout();this._initEmotions();this._initToolbar()},hide:function(){this.wrapper.parentNode.appendChild(this.textarea.element.remove());this.wrapper.hide()},show:function(){this.controllers.appendChild(this.textarea.element.remove());this.wrapper.show()},_initLayout:function(){this.wrapper=$(document.createElement("div"));this.wrapper.id="editor_wrapper";this.wrapper.className="clearfix";this.textarea.element.parentNode.insertBefore(this.wrapper,this.textarea.element);this.emotions=$(document.createElement("div"));this.emotions.id="bbcode_emotions";this.emotions.innerHTML="<h5>\u8868\u60c5\u56fe\u6807</h5>";this.wrapper.appendChild(this.emotions);this.controllers=$(document.createElement("div"));this.controllers.id="bbcode_controllers";this.wrapper.appendChild(this.controllers);this.toolbar=$(document.createElement("div"));this.toolbar.id="bbcode_toolbar";this.controllers.appendChild(this.toolbar);this.tooltip=$(document.createElement("div"));this.tooltip.id="bbcode_tooltip";this.tooltip.innerHTML="\u63d0\u793a\uff1a\u9009\u62e9\u60a8\u9700\u8981\u88c5\u9970\u7684\u6587\u5b57, \u6309\u4e0a\u5217\u6309\u94ae\u5373\u53ef\u6dfb\u52a0\u4e0a\u76f8\u5e94\u7684\u6807\u7b7e";this.controllers.appendChild(this.tooltip);this.controllers.appendChild(this.textarea.element.remove())},_initEmotions:function(){this._addEmotion("biggrin",function(){this.insertAfterSelection(" :D ")});this._addEmotion("smile",function(){this.insertAfterSelection(" :) ")});this._addEmotion("sad",function(){this.insertAfterSelection(" :( ")});this._addEmotion("surprised",function(){this.insertAfterSelection(" :o ")});this._addEmotion("eek",function(){this.insertAfterSelection(" :shock: ")});this._addEmotion("confused",function(){this.insertAfterSelection(" :? ")});this._addEmotion("cool",function(){this.insertAfterSelection(" 8) ")});this._addEmotion("lol",function(){this.insertAfterSelection(" :lol: ")});this._addEmotion("mad",function(){this.insertAfterSelection(" :x ")});this._addEmotion("razz",function(){this.insertAfterSelection(" :P ")});this._addEmotion("redface",function(){this.insertAfterSelection(" :oops: ")});this._addEmotion("cry",function(){this.insertAfterSelection(" :cry: ")});this._addEmotion("evil",function(){this.insertAfterSelection(" :evil: ")});this._addEmotion("twisted",function(){this.insertAfterSelection(" :twisted: ")});this._addEmotion("rolleyes",function(){this.insertAfterSelection(" :roll: ")});this._addEmotion("wink",function(){this.insertAfterSelection(" :wink: ")});this._addEmotion("exclaim",function(){this.insertAfterSelection(" :!: ")});this._addEmotion("question",function(){this.insertAfterSelection(" :?: ")});this._addEmotion("idea",function(){this.insertAfterSelection(" :idea: ")});this._addEmotion("arrow",function(){this.insertAfterSelection(" :arrow: ")})},_addEmotion:function(_,B){var A=$(document.createElement("img"));A.src="http://www.iteye.com/images/smiles/icon_"+_+".gif";A.observe("click",B.bindAsEventListener(this.textarea));this.emotions.appendChild(A)},_initToolbar:function(){this._addButton("B",function(){this.wrapSelection("[b]","[/b]")},function(){this.innerHTML="\u7c97\u4f53: [b]\u6587\u5b57[/b] (alt+b)"},{id:"button_bold"});this._addButton("I",function(){this.wrapSelection("[i]","[/i]")},function(){this.innerHTML="\u659c\u4f53: [i]\u6587\u5b57[/i] (alt+i)"},{id:"button_italic"});this._addButton("U",function(){this.wrapSelection("[u]","[/u]")},function(){this.innerHTML="\u4e0b\u5212\u7ebf: [u]\u6587\u5b57[/u] (alt+u)"},{id:"button_underline"});this._addButton("Quote",function(){this.wrapSelection("[quote]","[/quote]")},function(){this.innerHTML="\u5f15\u7528\u6587\u5b57: [quote]\u6587\u5b57[/quote] \u6216\u8005 [quote=\"iteye\"]\u6587\u5b57[/quote]  (alt+q)"});this._addButton("Code",function(){this.wrapSelection("[code=\"java\"]","[/code]")},function(){this.innerHTML="\u4ee3\u7801: [code=\"ruby\"]...[/code] (\u652f\u6301java, ruby, js, xml, html, php, python, c, c++, c#, sql)"});this._addButton("List",function(){this.insertBeforeEachSelectedLine("[*]","[list]\n","\n[/list]")},function(){this.innerHTML="\u5217\u8868: [list] [*]\u6587\u5b57 [*]\u6587\u5b57 [/list] \u6216\u8005 \u987a\u5e8f\u5217\u8868: [list=1] [*]\u6587\u5b57 [*]\u6587\u5b57 [/list]"});this._addButton("Img",function(){this.wrapSelection("[img]","[/img]")},function(){this.innerHTML="\u63d2\u5165\u56fe\u50cf: [img]http://image_url[/img]  (alt+p)"});this._addButton("URL",function(){this.wrapSelection("[url]","[/url]")},function(){this.innerHTML="\u63d2\u5165URL: [url]http://url[/url] \u6216 [url=http://url]URL\u6587\u5b57[/url]  (alt+w)"});this._addButton("Flash",function(){this.wrapSelection("[flash=200,200]","[/flash]")},function(){this.innerHTML="\u63d2\u5165Flash: [flash=\u5bbd,\u9ad8]http://your_flash.swf[/flash]"});this._addButton("Table",function(){this.injectEachSelectedLine(function(_,$){_.push("|"+$+"|");return _},"[table]\n","\n[/table]")},function(){this.innerHTML="\u63d2\u5165\u8868\u683c: [table]\u7528\u6362\u884c\u548c|\u6765\u7f16\u8f91\u683c\u5b50[/table]"});var _=["<br />\u5b57\u4f53\u989c\u8272: ","<select id='select_color'>","<option value='black' style='color: black;'>\u6807\u51c6</option>","<option value='darkred' style='color: darkred;'>\u6df1\u7ea2</option>","<option value='red' style='color: red;'>\u7ea2\u8272</option>","<option value='orange' style='color: orange;'>\u6a59\u8272</option>","<option value='brown' style='color: brown;'>\u68d5\u8272</option>","<option value='yellow' style='color: yellow;'>\u9ec4\u8272</option>","<option value='green' style='color: green;'>\u7eff\u8272</option>","<option value='olive' style='color: olive;'>\u6a44\u6984</option>","<option value='cyan' style='color: cyan;'>\u9752\u8272</option>","<option value='blue' style='color: blue;'>\u84dd\u8272</option>","<option value='darkblue' style='color: darkblue;'>\u6df1\u84dd</option>","<option value='indigo' style='color: indigo;'>\u975b\u84dd</option>","<option value='violet' style='color: violet;'>\u7d2b\u8272</option>","<option value='gray' style='color: gray;'>\u7070\u8272</option>","<option value='white' style='color: white;'>\u767d\u8272</option>","<option value='black' style='color: black;'>\u9ed1\u8272</option>","</select>"];this.toolbar.insert(_.join(""));$("select_color").observe("change",this._change_color.bindAsEventListener(this.textarea));$("select_color").observe("mouseover",function(){$("bbcode_tooltip").innerHTML="\u5b57\u4f53\u989c\u8272: [color=red]\u6587\u5b57[/color]  \u63d0\u793a\uff1a\u60a8\u53ef\u4ee5\u4f7f\u7528 color=#FF0000"});var B=["&nbsp;\u5b57\u4f53\u5927\u5c0f: ","<select id='select_font'>","<option value='0'>\u6807\u51c6</option>","<option value='xx-small'>1 (xx-small)</option>","<option value='x-small'>2 (x-small)</option>","<option value='small'>3 (small)</option>","<option value='medium'>4 (medium)</option>","<option value='large'>5 (large)</option>","<option value='x-large'>6 (x-large)</option>","<option value='xx-large'>7 (xx-large)</option>","</select>"];this.toolbar.insert(B.join(""));$("select_font").observe("change",this._change_font.bindAsEventListener(this.textarea));$("select_font").observe("mouseover",function(){$("bbcode_tooltip").innerHTML="\u5b57\u4f53\u5927\u5c0f: [size=x-small]\u5c0f\u5b57\u4f53\u6587\u5b57[/size]"});var A=["&nbsp;\u5bf9\u9f50: ","<select id='select_align'>","<option value='0'>\u6807\u51c6</option>","<option value='left'>\u5c45\u5de6</option>","<option value='center'>\u5c45\u4e2d</option>","<option value='right'>\u5c45\u53f3</option>","</select>"];this.toolbar.insert(A.join(""));$("select_align").observe("change",this._change_align.bindAsEventListener(this.textarea));$("select_align").observe("mouseover",function(){$("bbcode_tooltip").innerHTML="\u5bf9\u9f50: [align=center]\u6587\u5b57[/align]"})},_addButton:function(C,B,D,A){var _=$(document.createElement("input"));_.type="button";_.value=C;_.observe("click",B.bindAsEventListener(this.textarea));_.observe("mouseover",D.bindAsEventListener(this.tooltip));Object.extend(_,A||{});this.toolbar.appendChild(_)},_change_color:function(){this.wrapSelection("[color="+$F("select_color")+"]","[/color]");$("select_color").selectedIndex=0},_change_font:function(){this.wrapSelection("[size="+$F("select_font")+"]","[/size]");$("select_font").selectedIndex=0},_change_align:function(){this.wrapSelection("[align="+$F("select_align")+"]","[/align]");$("select_align").selectedIndex=0}});if(typeof window.console==="undefined")window.console={debug:function(){}};document.domain=/[^\.]+\.[^\.]+$/.exec(location.host)[0];if(typeof(tinyMCE)!="undefined")tinyMCE.init({plugins:"javaeye,media,table,emotions,contextmenu,fullscreen,inlinepopups",mode:"none",language:"zh-cn",theme:"advanced",theme_advanced_buttons1:"formatselect,fontselect,fontsizeselect,removeformat,separator,forecolor,backcolor,separator,bold,italic,underline,strikethrough,separator,bullist,numlist",theme_advanced_buttons2:"undo,redo,cut,copy,paste,separator,justifyleft,justifycenter,justifyright,separator,outdent,indent,separator,link,unlink,image,media,emotions,table,separator,quote,insertcode,separator,code,fullscreen",theme_advanced_buttons3:"",theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"left",theme_advanced_fonts:"\u5b8b\u4f53=SimSun,\\5B8B\\4F53,tahoma,arial,helvetica,sans-serif;"+"\u9ed1\u4f53=SimHei,\\9ED1\\4F53,tahoma,arial,helvetica,sans-serif;"+"\u5fae\u8f6f\u96c5\u9ed1=\"Microsoft YaHei\",\\5FAE\\8F6F\\96C5\\9ED1,SimHei,tahoma,arial,helvetica,sans-serif;"+"\u96b6\u4e66=LiSu,\\96B6\\4E66,tahoma,arial,helvetica,sans-serif;"+"\u4eff\u5b8b=FangSong_GB2312,\\4EFF\\5B8B_GB2312,tahoma,arial,helvetica,sans-serif;"+"\u6977\u4f53=KaiTi_GB2312,\\6977\\4F53_GB2312,tahoma,arial,helvetica,sans-serif;"+"\u5e7c\u5706=YouYuan,\\5E7C\\5706,tahoma,arial,helvetica,sans-serif;"+"Arial=arial,helvetica,sans-serif;"+"Comic Sans MS=comic sans ms,sans-serif;"+"Courier New=courier new,courier;"+"Tahoma=tahoma,arial,helvetica,sans-serif;"+"Times New Roman=times new roman,times;"+"Verdana=verdana,geneva;"+"Webdings=webdings;"+"Wingdings=wingdings,zapf dingbats;",theme_advanced_font_sizes:"10px,11px,12px,14px,16px,18px,20px,24px,36px",convert_fonts_to_spans:true,remove_trailing_nbsp:true,remove_linebreaks:false,width:"100%",extended_valid_elements:"pre[name|class],object[classid|codebase|width|height|align],param[name|value],embed[quality|type|pluginspage|width|height|src|align|wmode]",relative_urls:false,content_css:"/javascripts/tinymce/plugins/javaeye/css/content.css",doctype:"<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">",save_callback:"mceSaveCallback",setupcontent_callback:"mceSetupContentCallback"});function mceSaveCallback($,A,_){A=A.replace(/<pre([^>]*)>((?:.|\n)*?)<\/pre>/gi,function(A,$,_){_=_.replace(/<br\s*\/?>\n*/gi,"\n");return"<pre"+$+">"+_+"</pre>"});var B=/^\s*<div class="iteye-blog-content-contain"[^>]*>/i.exec(A);if(!B)A="<div class=\"iteye-blog-content-contain\" style=\"font-size: 14px\">"+A+"</div>";return A}function mceSetupContentCallback(_,B,C){var A="14px",D=$("editor_preview").style;D.fontSize=A;D.paddingLeft=D.paddingRight="8px";D.paddingTop="62px";D.width="";B.style.fontSize=A;B.style.lineHeight="1.5";B.style.fontFamily="Helvetica, Tahoma, Arial, sans-serif"}Control.TextArea.Editor=Class.create();Object.extend(Control.TextArea.Editor.prototype,{bbcode_editor:false,rich_editor:false,mode:false,in_preview:false,initialize:function(_,B,A){this.editor_bbcode_flag=$("editor_bbcode_flag");this.textarea=_;this.switchMode(B);if(A)this._initAutosave()},switchMode:function(C,B){if(this.in_preview&&this.mode==C){$("editor_tab_bbcode").removeClassName("activetab");$("editor_tab_rich").removeClassName("activetab");$("editor_tab_preview").removeClassName("activetab");$("editor_tab_"+C).addClassName("activetab");$("editor_preview").hide();$("editor_main").show();this.in_preview=false;return}if(this.mode==C)return;if(B){var A=this.getValue();if(A!=""){if(!confirm("\u5207\u6362\u7f16\u8f91\u5668\u6a21\u5f0f\u53ef\u80fd\u5bfc\u81f4\u683c\u5f0f\u548c\u5185\u5bb9\u4e22\u5931,\u4f60\u786e\u5b9a\u5417?"))return;$("editor_switch_spinner").show()}}this.mode=C;if($("editor_switch")){$("editor_tab_bbcode").removeClassName("activetab");$("editor_tab_rich").removeClassName("activetab");$("editor_tab_preview").removeClassName("activetab");$("editor_tab_"+C).addClassName("activetab");$("editor_preview").hide();$("editor_main").show();this.in_preview=false}if(this.mode=="rich"){this.editor_bbcode_flag.value="false";if(this.bbcode_editor)this.bbcode_editor.hide();this.rich_editor=true;tinyMCE.execCommand("mceAddControl",false,this.textarea)}else{this.editor_bbcode_flag.value="true";if(this.rich_editor)tinyMCE.execCommand("mceRemoveControl",false,this.textarea);if(this.bbcode_editor)this.bbcode_editor.show();else{try{this.bbcode_editor=new Control.TextArea.BBCode(this.textarea)}catch(_){console.debug(_+"")}}}if(B&&A!="")new Ajax.Request(this.mode=="rich"?"/editor/bbcode2html":"/editor/html2bbcode",{method:"post",parameters:{text:A},asynchronous:true,onSuccess:function(_){this.setValue(_.responseText);$("editor_switch_spinner").hide()}.bind(this)})},getValue:function(){if(this.mode==="bbcode"){try{return this.bbcode_editor.textarea.element.value}catch($){console.debug($+"")}}else return tinyMCE.activeEditor.getContent()},setValue:function($){if(this.mode=="bbcode")this.bbcode_editor.textarea.element.value=$;else tinyMCE.get(this.textarea).setContent($)},preview:function(){this.in_preview=true;$("editor_switch_spinner").show();$("editor_preview").show();$("editor_main").hide();$("editor_tab_bbcode").removeClassName("activetab");$("editor_tab_rich").removeClassName("activetab");$("editor_tab_preview").addClassName("activetab");new Ajax.Updater("editor_preview","/editor/preview",{parameters:{text:this.getValue(),mode:this.mode},evalScripts:true,onSuccess:function(){$("editor_switch_spinner").hide()}})},insertImage:function($){if(this.mode=="bbcode")this.bbcode_editor.textarea.insertAfterSelection("\n[img]"+$+"[/img]\n");else tinyMCE.execCommand("mceInsertContent",false,"<br/><img src='"+$+"'/><br/>&nbsp;")},_initAutosave:function(){this.autosave_url=window.location.href;new Ajax.Request("/editor/check_autosave",{method:"post",parameters:{url:this.autosave_url},asynchronous:true,onSuccess:this._loadAutosave.bind(this)});setInterval(this._autosave.bind(this),90*1000)},_loadAutosave:function(transport){var text=transport.responseText;if(text!="nil"){eval("this.auto_save = "+text);$("editor_auto_save_update").update("<span style=\"color:red\">\u60a8\u6709\u4e00\u4efd\u81ea\u52a8\u4fdd\u5b58\u4e8e"+this.auto_save.updated_at+"\u7684\u8349\u7a3f\uff0c<a href=\"#\" onclick='editor._setAutosave();return false;'>\u6062\u590d</a>\u8fd8\u662f<a href=\"#\" onclick='editor._discardAutosave();return false;'>\u4e22\u5f03</a>\u5462\uff1f</span>")}},_setAutosave:function(){$("editor_auto_save_id").value=this.auto_save.id;$("editor_auto_save_update").update("");this.auto_save.bbcode?this.switchMode("bbcode"):this.switchMode("rich");this.setValue(this.auto_save.body)},_discardAutosave:function(){$("editor_auto_save_id").value=this.auto_save.id;$("editor_auto_save_update").update("")},_autosave:function(){var _=this.getValue();if(_.length<100)return;new Ajax.Request("/editor/autosave",{method:"post",parameters:{url:this.autosave_url,body:_,bbcode:this.mode=="bbcode"},asynchronous:true,onSuccess:function(A){var _=new Date();$("editor_auto_save_id").value=A.responseText;$("editor_auto_save_update").update("<span style=\"color:red\">ITeye\u7f16\u8f91\u5668\u5e2e\u60a8\u81ea\u52a8\u4fdd\u5b58\u8349\u7a3f\u4e8e\uff1a"+_.getHours()+":"+_.getMinutes()+":"+_.getSeconds()+"</span>")}})}})